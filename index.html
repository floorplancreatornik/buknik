<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Author's Bookstore</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --accent: #007bff;
            --border: #e0e0e0;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #ccc;
            --accent: #4dabf7;
            --border: #444;
        }
        [data-theme="warm"] {
            --bg-primary: #fdf6e3;
            --bg-secondary: #f9e4b7;
            --text-primary: #5f4b32;
            --text-secondary: #8b7355;
            --accent: #d97706;
            --border: #e6ccb2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 12px 20px;
            display: flex; align-items: center; justify-content: space-between;
            z-index: 1000;
            box-shadow: var(--shadow);
        }
        .logo { font-size: 24px; font-weight: bold; color: var(--accent); }
        .top-controls { display: flex; gap: 10px; align-items: center; }
        .btn { 
            padding: 8px 16px; border: 1px solid var(--accent); 
            background: var(--accent); color: white; 
            border-radius: 6px; cursor: pointer; font-size: 14px;
            transition: all 0.2s;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .theme-toggle { background: none; border: none; color: var(--text-primary); font-size: 20px; cursor: pointer; padding: 8px; }
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around;
            padding: 12px 0; z-index: 1000;
            box-shadow: var(--shadow);
        }
        .tab-btn { 
            display: flex; flex-direction: column; align-items: center;
            gap: 4px; padding: 8px; color: var(--text-secondary);
            cursor: pointer; transition: all 0.2s;
            font-size: 12px;
        }
        .tab-btn.active { color: var(--accent); }
        .main-content { padding: 80px 16px 100px; min-height: 100vh; }
        .slide-container { display: flex; transition: transform 0.4s ease; }
        .slide { min-width: 100%; padding: 40px 20px; text-align: center; }
        .slide h2 { margin-bottom: 30px; font-size: 28px; }
        .lang-btn { 
            width: 140px; height: 60px; margin: 10px; 
            font-size: 18px; border-radius: 12px;
        }
        input { 
            width: 100%; padding: 16px; margin: 12px 0;
            border: 2px solid var(--border); border-radius: 12px;
            font-size: 16px; transition: border-color 0.2s;
        }
        input:focus { outline: none; border-color: var(--accent); }
        .numeric-input { font-family: monospace; }
        .btn-primary { 
            width: 100%; padding: 18px; margin-top: 20px;
            font-size: 18px; background: var(--accent); 
            border: none; border-radius: 12px; color: white;
        }
        .book-card { 
            background: var(--bg-secondary); 
            border-radius: 16px; padding: 20px; margin: 16px 0;
            display: flex; gap: 16px; cursor: pointer;
            transition: all 0.2s; box-shadow: var(--shadow);
        }
        .book-card:hover { transform: translateY(-4px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .book-cover { width: 80px; height: 120px; object-fit: cover; border-radius: 8px; }
        .book-info h3 { margin-bottom: 8px; color: var(--text-primary); }
        .book-meta { font-size: 14px; color: var(--text-secondary); margin: 4px 0; }
        .price { font-size: 18px; font-weight: bold; color: var(--accent); }
        .search-bar { 
            position: sticky; top: 80px; background: var(--bg-primary);
            padding: 16px; margin: -16px -16px 20px; border-radius: 0 0 16px 16px;
            box-shadow: var(--shadow);
        }
        .filter-chips { display: flex; gap: 8px; margin: 16px 0; flex-wrap: wrap; }
        .chip { 
            padding: 8px 16px; background: var(--bg-secondary); 
            border-radius: 20px; font-size: 14px; cursor: pointer;
        }
        .cart-item { display: flex; gap: 16px; padding: 20px; border-bottom: 1px solid var(--border); }
        .cart-thumbnail { width: 60px; height: 90px; object-fit: cover; border-radius: 8px; }
        .qty-controls { display: flex; gap: 8px; align-items: center; }
        .qty-btn { width: 32px; height: 32px; border: 1px solid var(--border); background: var(--bg-secondary); border-radius: 50%; cursor: pointer; }
        .total { font-size: 24px; font-weight: bold; text-align: center; padding: 20px; border-top: 3px solid var(--accent); }
        .profile-field { 
            background: var(--bg-secondary); padding: 20px; 
            border-radius: 12px; margin: 12px 0; text-align: center;
        }
        .preview-gallery { display: flex; gap: 8px; overflow-x: auto; padding: 16px 0; }
        .preview-img { width: 120px; height: 160px; object-fit: cover; border-radius: 8px; flex-shrink: 0; }
        .reviews { margin-top: 30px; }
        .review { background: var(--bg-secondary); padding: 16px; border-radius: 12px; margin: 12px 0; }
        .stars { color: #ffc107; font-size: 18px; }
        .hidden { display: none !important; }
        @media (max-width: 480px) {
            .main-content { padding: 70px 12px 90px; }
            .top-bar { padding: 10px 12px; }
        }
    </style>
</head>
<body data-theme="light">
    <div class="top-bar">
        <div class="logo">üìö</div>
        <div>Author's Bookstore</div>
        <div class="top-controls">
            <button class="btn" onclick="downloadApp()">Download app</button>
            <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
        </div>
    </div>

    <div class="bottom-bar hidden" id="bottomBar">
        <div class="tab-btn active" onclick="showTab('home')">
            <span>üè†</span>Home
        </div>
        <div class="tab-btn" onclick="showTab('cart')">
            <span>üõí</span>Cart
        </div>
        <div class="tab-btn" onclick="showTab('profile')">
            <span>üë§</span>Profile
        </div>
    </div>

    <div class="main-content" id="mainContent">
        <!-- Onboarding Slides -->
        <div id="onboarding" class="slide-container">
            <div class="slide">
                <h2 id="lang-title">Choose Language</h2>
                <button class="lang-btn btn-primary" onclick="setLanguage('en')">English</button>
                <button class="lang-btn btn-primary" onclick="setLanguage('ml')">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            </div>
            <div class="slide hidden">
                <h2 id="details-title">Enter Details</h2>
                <input type="text" id="fullName" placeholder="Full Name" required>
                <div style="position: relative;">
                    <input type="tel" id="phone" class="numeric-input" placeholder="Phone Number" maxlength="10" minlength="10" pattern="[0-9]{10}" inputmode="numeric">
                    <span style="position: absolute; left: 16px; top: 18px; pointer-events: none; color: var(--text-secondary);">+91</span>
                </div>
                <button class="btn-primary" onclick="nextSlide(2)">Continue</button>
            </div>
            <div class="slide hidden">
                <h2 id="login-title">Login</h2>
                <p>Click below to login with Google</p>
                <button class="btn-primary" onclick="completeOnboarding()">Complete Setup</button>
            </div>
        </div>

        <!-- Home Tab -->
        <div id="homeTab" class="hidden">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search books‚Ä¶" oninput="filterBooks()">
            </div>
            <div class="filter-chips" id="filterChips">
                <span class="chip" onclick="filterBooks('all')">All</span>
                <span class="chip" onclick="filterBooks('en')">English</span>
                <span class="chip" onclick="filterBooks('ml')">Malayalam</span>
            </div>
            <div id="bookList"></div>
        </div>

        <!-- Cart Tab -->
        <div id="cartTab" class="hidden">
            <div id="cartItems"></div>
            <div class="total" id="grandTotal">‚Çπ0.00</div>
            <button class="btn-primary" onclick="showTab('home')" style="margin: 20px;">Browse Books</button>
            <button class="btn-primary" onclick="showPayment()" id="payBtn" disabled>Pay Now</button>
        </div>

        <!-- Profile Tab -->
        <div id="profileTab" class="hidden">
            <div class="profile-field">
                <strong id="profileName">-</strong>
            </div>
            <div class="profile-field">
                Phone: <strong id="profilePhone">-</strong>
            </div>
            <div class="profile-field">
                Email: <strong id="profileEmail">-</strong>
            </div>
            <div style="margin: 20px 0;">
                <button class="lang-btn btn-primary" onclick="setLanguage('en')" style="width: 48%; margin-right: 4%;">English</button>
                <button class="lang-btn btn-primary" onclick="setLanguage('ml')" style="width: 48%;">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            </div>
            <button class="btn" onclick="donate()" style="background: #10b981;">Donate to Author</button>
            <br><br>
            <button class="btn" onclick="logout()" style="background: #ef4444;">Logout</button>
        </div>
    </div>

    <script>
        // Sample book data
        const books = [
            {id: 1, title: 'My Journey', desc: 'Autobiographical memoir of self-discovery', lang: 'en', pages: 280, format: 'PDF/ePub', price: 299, rating: 4.5, date: '2025-01-15', cover: 'https://via.placeholder.com/80x120/007bff/ffffff?text=Book+1', previews: ['https://via.placeholder.com/120x160/007bff/ffffff?text=Preview+1', 'https://via.placeholder.com/120x160/007bff/ffffff?text=Preview+2']},
            {id: 2, title: '‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥Ø‡¥æ‡¥§‡µç‡¥∞', desc: '‡¥Ü‡¥§‡µç‡¥Æ‡¥ï‡¥•‡¥æ‡¥™‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥ì‡µº‡¥Æ‡µç‡¥Æ‡¥ï‡µæ', lang: 'ml', pages: 320, format: 'PDF/ePub', price: 349, rating: 4.8, date: '2025-02-20', cover: 'https://via.placeholder.com/80x120/ff6b6b/ffffff?text=Book+2', previews: ['https://via.placeholder.com/120x160/ff6b6b/ffffff?text=Preview+1', 'https://via.placeholder.com/120x160/ff6b6b/ffffff?text=Preview+2']},
            {id: 3, title: 'Philosophical Thoughts', desc: 'Deep reflections on life and existence', lang: 'en', pages: 210, format: 'PDF', price: 249, rating: 4.2, date: '2025-03-10', cover: 'https://via.placeholder.com/80x120/10b981/ffffff?text=Book+3', previews: ['https://via.placeholder.com/120x160/10b981/ffffff?text=Preview+1']},
        ];

        let currentUser = JSON.parse(localStorage.getItem('userData')) || null;
        let currentLanguage = localStorage.getItem('appLanguage') || 'en';
        let currentTab = 'home';
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentSlide = 0;
        let theme = localStorage.getItem('theme') || 'light';

        // Translations
        const translations = {
            en: {
                langTitle: 'Choose Language',
                detailsTitle: 'Enter Your Details',
                loginTitle: 'Complete Setup',
                searchPlaceholder: 'Search books‚Ä¶',
                profileNote: 'To change details, logout and signup again',
                donateBtn: 'Donate to support the author',
                logoutBtn: 'Logout'
            },
            ml: {
                langTitle: '‡¥≠‡¥æ‡¥∑ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï',
                detailsTitle: '‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï',
                loginTitle: '‡¥∏‡¥ú‡µç‡¥ú‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡µΩ ‡¥™‡µÇ‡µº‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥ï',
                searchPlaceholder: '‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥ô‡µç‡¥ô‡µæ ‡¥§‡¥ø‡¥∞‡¥Ø‡µÅ‡¥ï‚Ä¶',
                profileNote: '‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥æ‡µª ‡¥≤‡µã‡¥ó‡µó‡¥ü‡µç‡¥ü‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥µ‡µÄ‡¥£‡µç‡¥ü‡µÅ‡¥Ç ‡¥∏‡µà‡µª‡¥á‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï',
                donateBtn: '‡¥≤‡µá‡¥ñ‡¥ï‡¥®‡µÜ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥∏‡¥Ç‡¥≠‡¥æ‡¥µ‡¥® ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï',
                logoutBtn: '‡¥≤‡µã‡¥ó‡µó‡¥ü‡µç‡¥ü‡µç'
            }
        };

        function init() {
            applyTheme();
            document.documentElement.lang = currentLanguage;
            if (!currentUser) {
                showOnboarding();
            } else {
                showMainApp();
                updateProfileDisplay();
                renderHome();
                updateCart();
            }
            updateTexts();
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('appLanguage', lang);
            document.documentElement.lang = lang;
            updateTexts();
            if (currentSlide === 0) nextSlide(1);
        }

        function nextSlide(slide) {
            document.querySelectorAll('.slide')[currentSlide].classList.add('hidden');
            currentSlide = slide;
            document.querySelectorAll('.slide')[slide].classList.remove('hidden');
        }

        function completeOnboarding() {
            const name = document.getElementById('fullName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !phone || phone.length !== 10) {
                alert('Please fill all fields correctly');
                return;
            }

            currentUser = {
                name,
                phone: '+91' + phone,
                email: name.toLowerCase() + '@example.com', // Simulated OAuth
                oauth: true
            };
            
            localStorage.setItem('userData', JSON.stringify(currentUser));
            showMainApp();
            updateProfileDisplay();
            renderHome();
        }

        function showMainApp() {
            document.getElementById('onboarding').classList.add('hidden');
            document.getElementById('bottomBar').classList.remove('hidden');
            showTab('home');
        }

        function showOnboarding() {
            document.getElementById('onboarding').classList.remove('hidden');
            document.getElementById('bottomBar').classList.add('hidden');
            document.querySelectorAll('#mainContent > div:not(#onboarding)').forEach(el => el.classList.add('hidden'));
        }

        function showTab(tab) {
            document.querySelectorAll('#mainContent > div:not(#onboarding)').forEach(el => el.classList.add('hidden'));
            document.getElementById(tab + 'Tab').classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
            currentTab = tab;
            
            if (tab === 'home') renderHome();
            if (tab === 'cart') updateCart();
            if (tab === 'profile') updateProfileDisplay();
        }

        function renderHome() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const bookList = document.getElementById('bookList');
            const filteredBooks = books.filter(book => 
                book.title.toLowerCase().includes(search) ||
                book.desc.toLowerCase().includes(search)
            );
            
            bookList.innerHTML = filteredBooks.map(book => `
                <div class="book-card" onclick="showBookDetail(${book.id})">
                    <img src="${book.cover}" class="book-cover" alt="${book.title}">
                    <div style="flex: 1;">
                        <h3>${book.title}</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">${book.desc}</p>
                        <div class="book-meta">${book.pages} pages ‚Ä¢ ${book.lang.toUpperCase()} ‚Ä¢ ${book.format}</div>
                        <div class="price">‚Çπ${book.price}</div>
                    </div>
                </div>
            `).join('');
        }

        function showBookDetail(id) {
            const book = books.find(b => b.id === id);
            if (!book) return;
            
            document.getElementById('bookList').innerHTML = `
                <div style="background: var(--bg-secondary); padding: 24px; border-radius: 16px; margin: 20px 0;">
                    <img src="${book.cover}" style="width: 100%; max-width: 300px; height: 400px; object-fit: cover; border-radius: 16px; display: block; margin: 0 auto;">
                    <h2 style="text-align: center; margin: 20px 0;">${book.title}</h2>
                    <div style="display: grid; gap: 12px; margin: 20px 0;">
                        <div><strong>Language:</strong> ${book.lang.toUpperCase()}</div>
                        <div><strong>Pages:</strong> ${book.pages}</div>
                        <div><strong>Format:</strong> ${book.format}</div>
                        <div><strong>Price:</strong> ‚Çπ${book.price}</div>
                        <div><strong>Rating:</strong> ${'‚òÖ'.repeat(Math.floor(book.rating))} ${book.rating}/5</div>
                    </div>
                    <div class="preview-gallery">
                        ${book.previews.map(p => `<img src="${p}" class="preview-img" alt="Preview">`).join('')}
                    </div>
                    <div style="display: flex; gap: 12px; margin: 24px 0;">
                        <button class="btn" onclick="toggleWishlist(${book.id})" style="flex: 1;">‚ù§Ô∏è Wishlist</button>
                        <button class="btn" onclick="addToCart(${book.id}); showTab('cart')" style="flex: 2;">Add to Cart</button>
                    </div>
                    <button class="btn-primary" onclick="showTab('home')" style="width: 100%;">Back to Books</button>
                </div>
                ${renderReviews(book.id)}
            `;
        }

        function renderReviews(bookId) {
            return `
                <div class="reviews">
                    <h3>Reviews</h3>
                    <div class="review">
                        <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        <strong>Rajesh K</strong> ‚Ä¢ 2 days ago ‚Ä¢ <span style="color: green;">Verified</span><br>
                        "Excellent read! Highly recommended."
                    </div>
                </div>
            `;
        }

        function addToCart(bookId) {
            const book = books.find(b => b.id === bookId);
            const existing = cart.find(item => item.id === bookId);
            if (existing) {
                existing.quantity += 1;
            } else {
                cart.push({ ...book, quantity: 1 });
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
        }

        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            cartItems.innerHTML = cart.length ? cart.map(item => `
                <div class="cart-item">
                    <img src="${item.cover}" class="cart-thumbnail">
                    <div style="flex: 1;">
                        <h4>${item.title}</h4>
                        <div>‚Çπ${item.price} √ó 
                            <div class="qty-controls">
                                <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">‚àí</button>
                                <span>${item.quantity}</span>
                                <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                            </div> = ‚Çπ${item.price * item.quantity}
                        </div>
                    </div>
                    <button class="btn" onclick="removeFromCart(${item.id})" style="background: #ef4444;">Remove</button>
                </div>
            `).join('') : '<p style="text-align: center; color: var(--text-secondary);">Your cart is empty</p>';
            
            document.getElementById('grandTotal').textContent = `Total: ‚Çπ${total.toFixed(2)}`;
            document.getElementById('payBtn').disabled = total === 0;
        }

        function updateQuantity(id, delta) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity = Math.max(1, item.quantity + delta);
                if (item.quantity === 0) {
                    cart = cart.filter(item => item.id !== id);
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCart();
            }
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
        }

        function showPayment() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            if (total === 0) return;
            
            document.getElementById('cartItems').innerHTML = `
                <div style="background: var(--bg-secondary); padding: 24px; border-radius: 16px; margin: 20px 0;">
                    <h3>Payment Details</h3>
                    <input type="text" id="payName" value="${currentUser?.name || ''}" placeholder="Full Name">
                    <input type="tel" id="payPhone" value="${currentUser?.phone || ''}" placeholder="Phone">
                    <input type="email" id="payEmail" value="${currentUser?.email || ''}" placeholder="Email">
                    <textarea id="address" placeholder="House, Street, City, State" rows="3" style="width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 12px;"></textarea>
                    <div style="position: relative;">
                        <input type="text" id="pincode" class="numeric-input" placeholder="Pincode" maxlength="6" inputmode="numeric" style="padding-left: 60px;">
                        <span style="position: absolute; left: 16px; top: 18px; pointer-events: none; color: var(--text-secondary);">Pincode</span>
                    </div>
                    <div class="total" style="margin: 20px 0;">Order Total: ‚Çπ${total.toFixed(2)}</div>
                    <button class="btn-primary" onclick="processPayment(${total})" style="width: 100%;">Pay with Razorpay</button>
                    <button class="btn" onclick="showTab('cart')" style="width: 100%; margin-top: 12px;">Back to Cart</button>
                </div>
            `;
        }

        function processPayment(amount) {
            const options = {
                key: "rzp_test_your_key_here", // Replace with your actual Razorpay key
                amount: amount * 100,
                currency: "INR",
                name: "Author's Bookstore",
                description: "Book Purchase",
                image: "https://via.placeholder.com/150x150/007bff/ffffff?text=üìö",
                handler: function (response) {
                    alert('Payment successful! Order ID: ' + response.razorpay_order_id);
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    showTab('home');
                },
                prefill: {
                    name: document.getElementById('payName').value,
                    contact: document.getElementById('payPhone').value.replace('+91', ''),
                    email: document.getElementById('payEmail').value
                },
                theme: { color: "#007bff" }
            };
            const rzp = new Razorpay(options);
            rzp.open();
        }

        function updateProfileDisplay() {
            if (currentUser) {
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profilePhone').textContent = currentUser.phone;
                document.getElementById('profileEmail').textContent = currentUser.email;
            }
        }

        function donate() {
            const options = {
                key: "rzp_test_your_key_here", // Replace with your actual Razorpay key
                amount: 100 * 100, // ‚Çπ100 default donation
                currency: "INR",
                name: "Support Author",
                description: "Donation to support great writing",
                image: "https://via.placeholder.com/150x150/10b981/ffffff?text=‚ù§Ô∏è",
                handler: function (response) {
                    alert('Thank you for your generous donation!');
                },
                theme: { color: "#10b981" },
                modal: { ondismiss: function(){} }
            };
            const rzp = new Razorpay(options);
            rzp.open();
        }

        function logout() {
            localStorage.removeItem('userData');
            localStorage.removeItem('cart');
            cart = [];
            currentUser = null;
            showOnboarding();
        }

        function toggleTheme() {
            const themes = ['light', 'dark', 'warm'];
            const currentIndex = themes.indexOf(theme);
            theme = themes[(currentIndex + 1) % themes.length];
            localStorage.setItem('theme', theme);
            applyTheme();
        }

        function applyTheme() {
            document.body.setAttribute('data-theme', theme);
            document.querySelector('.theme-toggle').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        function updateTexts() {
            const t = translations[currentLanguage];
            document.getElementById('lang-title').textContent = t.langTitle;
            document.getElementById('details-title').textContent = t.detailsTitle;
            document.getElementById('login-title').textContent = t.loginTitle;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
        }

        function filterBooks(filter = 'all') {
            // Simple filter implementation - full filtering in renderHome handles search
            renderHome();
        }

        function downloadApp() {
            // PWA install prompt
            if (window.deferredPrompt) {
                window.deferredPrompt.prompt();
            } else {
                alert('Save this page to your home screen for app-like experience!');
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', renderHome);
        document.getElementById('phone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
        document.getElementById('pincode').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // PWA Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                self.addEventListener('install', e => {
                    self.skipWaiting();
                });
                self.addEventListener('activate', e => {
                    self.clients.claim();
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(fetch(e.request));
                });
            `));
        }

        // Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });

        init();
    </script>
</body>
</html>
